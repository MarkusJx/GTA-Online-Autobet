"use strict";const startstop=document.getElementById("startstop");mdc.ripple.MDCRipple.attachTo(startstop);let gta_running=!1;const errordialog=new mdc.dialog.MDCDialog(document.getElementById("error-dialog-container"));function exception(){try{errordialog.open(),errordialog.listen("MDCDialog:closed",()=>{try{autobetLib.shutdown()}catch(ignored){}electron.quit()})}catch(e){console.error(`Error in function exception: ${e}`)}}try{const showqrbutton=document.getElementById("showqrbutton");mdc.ripple.MDCRipple.attachTo(showqrbutton);const moneythishour=document.getElementById("moneythishour"),raceswon=document.getElementById("raceswon"),winprobability=document.getElementById("winprobability"),moneyall=document.getElementById("moneyall"),namecontainter=document.getElementById("namecontainer"),weblink=document.getElementById("weblink");mdc.ripple.MDCRipple.attachTo(weblink),mdc.autoInit();const qrdialog=new mdc.dialog.MDCDialog(document.getElementById("qrdialog")),enable_webserver=new mdc.switchControl.MDCSwitch(document.getElementById("enable-webserver-switch")),settings_saved_msg=new mdc.snackbar.MDCSnackbar(document.getElementById("settings-saved-message"));settings_saved_msg.timeoutMs=4e3;const bettingErrorDialog=new mdc.dialog.MDCDialog(document.getElementById("betting-error-dialog")),game_running=document.getElementById("game-running"),license_dialog=new mdc.dialog.MDCDialog(document.getElementById("license-dialog"));async function setQuitCallback(){autobetLib.callbacks.setQuitCallback(()=>{electron.quit()})}document.getElementById("copyright-opener").addEventListener("click",()=>{license_dialog.open()}),setQuitCallback(),autobetLib.callbacks.setBettingExceptionCallback(err=>{document.getElementById("betting-error-dialog-content").innerText="The betting was stopped due to an exception thrown in the native module. This may be caused by a program error or the game being stuck on a screen. Error message: "+err,bettingErrorDialog.open()}),document.getElementById("autobet-version").innerText=`Version ${autobet_info.version}`,namecontainter.onmouseenter=()=>{namecontainter.classList="hovered subcontainer",document.getElementById("copyright").classList="hovered",document.getElementById("autobet-version").classList="hovered"},namecontainter.onmouseleave=()=>{namecontainter.classList="subcontainer",document.getElementById("copyright").classList="",document.getElementById("autobet-version").classList=""};let moneyMade=0,won=0,lost=0;function showQRCode(){qrdialog.open(),startstop.disabled=!0,showqrbutton.disabled=!0}function makeSumsDisplayable(sum,k=!1){const negative=sum<0;let res;return res=(sum=Math.abs(sum))>=1e9?(sum/1e9).toFixed(2)+"B":sum>=1e6?(sum/1e6).toFixed(2)+"M":k&&sum>=1e3?(sum/1e3).toFixed(2)+"K":sum,negative?"-$"+res:"$"+res}function addMoney(value){0!==value?(moneyMade+=value,value>0&&won++):lost++,updateValues()}function setAllMoneyMade(value){moneyall.innerText=makeSumsDisplayable(value)}function updateValues(){moneythishour.innerText=makeSumsDisplayable(getMoneyPerHour(),!0)+"/hr",raceswon.innerText=won,winprobability.innerText=Math.round(won/(won+lost)*1e3)/10+"%"}function getMoneyPerHour(){return moneyMade*(3600/time)}function set_gta_running(val){gta_running=val,gta_running?(game_running.innerText="Yes",game_running.className="text status_running maintext"):(game_running.innerText="No",game_running.className="text status_stopped maintext")}function setQRCode(ip){document.getElementById("qrcode").innerHTML="",new QRCode(document.getElementById("qrcode"),{text:"http://"+ip+":8027",width:352,height:352,colorDark:"#000000",colorLight:"#ffffff"})}function setIPs(){let ip=autobetLib.getIP();weblink.innerText="http://"+ip+":8027",setQRCode(ip)}async function main(){let initialized;startstop.disabled=!0,titlebar.create(),enable_webserver.disabled=!0,showqrbutton.disabled=!0,await autobetLib.init()?(statusinfo.classList.remove("status_init"),statusinfo.classList.add("status_stopped"),statusinfo.innerText="Stopped",autobetLib.logging.debug("main.js","autobetlib initialized."),startstop.disabled=!1,autobet_info.getLicense().then(res=>{document.getElementById("license-dialog-content").innerText=res},rej=>{autobetLib.logging.error("main.js","Could not get the license: "+rej)}),await autobetLib.loadWinnings(),time_sleep_field.value=autobetLib.settings.getTimeSleep(),log_to_file_switch.checked=autobetLib.logging.isLoggingToFile(),log_to_console_switch.checked=autobetLib.logging.isLoggingToConsole(),autobetLib.logging.isLoggingToConsole()&&(log_textfield_resizer.style.height="178px"),enable_webserver.checked=autobetLib.settings.webServerActivated(),autobetLib.settings.webServerActivated()?autobetLib.startWebServer().then(initialized=>{enable_webserver.checked=initialized,initialized?(autobetLib.logging.debug("main.js","Web server started."),weblink.disabled=!1,showqrbutton.disabled=!1,setIPs()):(autobetLib.logging.error("main.js","Could not start web server"),weblink.disabled=!0,weblink.innerText="not running",showqrbutton.disabled=!0),enable_webserver.disabled=!1}):(weblink.disabled=!0,weblink.innerText="not running",showqrbutton.disabled=!0,enable_webserver.disabled=!1),autobetLib.setOddTranslations(),autobetLib.start()):autobetLib.logging.error("main.js","Could not initialize")}qrdialog.listen("MDCDialog:closing",(function(){startstop.disabled=!1,showqrbutton.disabled=!1})),showqrbutton.addEventListener("click",(function(){showQRCode()})),autobetLib.callbacks.setExceptionCallback(exception),autobetLib.callbacks.setAddMoneyCallback(addMoney),autobetLib.callbacks.setAllMoneyMadeCallback(setAllMoneyMade),autobetLib.callbacks.setGtaRunningCallback(set_gta_running),weblink.addEventListener("click",()=>{autobetLib.openWebsite()}),enable_webserver.listen("change",()=>{enable_webserver.disabled=!0,autobetLib.settings.setWebServer(enable_webserver.checked).then(res=>{res||(enable_webserver.checked=autobetLib.settings.webServerRunning()),enable_webserver.checked?(weblink.disabled=!1,showqrbutton.disabled=!1,setIPs()):(weblink.disabled=!0,weblink.innerText="not running",showqrbutton.disabled=!0),autobetLib.settings.saveSettings().then(()=>{enable_webserver.disabled=!1,settings_saved_msg.close(),settings_saved_msg.open()})})}),window.onbeforeunload=function(){autobetLib.shutdown().then(()=>{electron.quit()})},main().then(()=>{autobetLib.logging.debug("main.js","JS main function finished")},()=>{errordialog.open(),errordialog.listen("MDCDialog:closed",(function(){autobetLib.shutdown(),electron.quit()}))});const description_dialog=new mdc.dialog.MDCDialog(document.getElementById("description-dialog")),time_sleep_field=new mdc.textField.MDCTextField(document.getElementById("time-sleep-field")),full_debug=new mdc.switchControl.MDCSwitch(document.getElementById("full-debug-switch")),log_to_file_switch=new mdc.switchControl.MDCSwitch(document.getElementById("log-to-file-switch")),log_to_console_switch=new mdc.switchControl.MDCSwitch(document.getElementById("log-to-console-switch")),log_textfield=new mdc.textField.MDCTextField(document.getElementById("log-textfield")),log_textfield_resizer=document.getElementById("log-textfield-resizer");function showDescription(title,description){document.getElementById("description-dialog-title").innerText=title,description_dialog.content_.innerText=description,description_dialog.open()}time_sleep_field.input_.addEventListener("keyup",event=>{13===event.keyCode&&(event.preventDefault(),0!==time_sleep_field.value.length&&(autobetLib.settings.setTimeSleep(Number(time_sleep_field.value)),time_sleep_field.disabled=!0,autobetLib.settings.saveSettings().then(()=>{time_sleep_field.disabled=!1,settings_saved_msg.close(),settings_saved_msg.open()})))}),full_debug.listen("change",()=>{full_debug.disabled=!0,full_debug.checked?(log_to_file_switch.checked=!0,log_to_file_switch.disabled=!0,autobetLib.logging.isLoggingToFile()||(autobetLib.logging.setLogToFile(!0),autobetLib.settings.saveSettings().then(()=>{settings_saved_msg.close(),settings_saved_msg.open()}))):log_to_file_switch.disabled=!1,autobetLib.settings.setDebugFull(full_debug.checked).then(res=>{full_debug.disabled=!1,res||(full_debug.checked=!1,autobetLib.logging.warn("main.js","setDebugFull returned false"))})}),log_to_file_switch.listen("change",()=>{log_to_file_switch.disabled=!0,autobetLib.logging.setLogToFile(log_to_file_switch.checked),autobetLib.settings.saveSettings().then(()=>{log_to_file_switch.disabled=!1,settings_saved_msg.close(),settings_saved_msg.open()})}),log_to_console_switch.listen("change",()=>{log_to_console_switch.disabled=!0,autobetLib.logging.setLogToConsole(log_to_console_switch.checked),log_to_console_switch.checked?"56px"===log_textfield_resizer.style.height&&(log_textfield_resizer.className="mdc-text-field__resizer increase-height",setTimeout(()=>{log_textfield_resizer.style.height="178px"},500)):(log_textfield.value="",log_textfield_resizer.style.height="56px",setTimeout(()=>{log_textfield.value="",log_textfield_resizer.style.height="56px"},500),log_textfield_resizer.className="mdc-text-field__resizer decrease-height",setTimeout(()=>{log_textfield_resizer.className="mdc-text-field__resizer"},500)),autobetLib.settings.saveSettings().then(()=>{log_to_console_switch.disabled=!1,settings_saved_msg.close(),settings_saved_msg.open()})}),autobetLib.logging.setLogCallback(msg=>{log_textfield.input_.scrollTop+log_textfield.input_.clientHeight>=log_textfield.input_.scrollHeight-20?(log_textfield.value+=msg,log_textfield.input_.scroll({top:log_textfield.input_.scrollHeight,left:0})):log_textfield.value+=msg}),document.getElementById("time-sleep-info").addEventListener("click",()=>{showDescription("Time-sleep","Set the time to sleep after a bet has started. Use this option, when the program did not immediately start a new bet when the race has finished. Press enter to save, the default value is 36.")}),document.getElementById("full-debug-info").addEventListener("click",()=>{showDescription("Full Debug","This option will create a zip file called 'autobet_debug.zip' on you Desktop. This File will contain a log and screenshots for debugging purposes. IMPORTANT: If you submit this file anywhere, make sure to delete any personal information from the zip file.")}),document.getElementById("debug-info").addEventListener("click",()=>{showDescription("Debugging and logging","Log to File: Set if the program should log to a file. This option will automatically activated, when the full debug option is activated. Log to Console: This option will display logging information in the 'View log' text field.")}),document.getElementById("custom-betting-function-info").addEventListener("click",()=>{showDescription("Custom betting function","In here you can set a custom function to be called in order to determine whether (an where) a bet should be placed.The function should be written in JavaScript, the odds are stored in the odds variable and at the end, you should pass the odd for a bet to be placed on to the setResult() function. If no bet should be placed, pass null to setResult(). If you don't pass anythin, the result will be interpreted as invalid and the Program will fall back to the native implementation.")})}catch(e){try{autobetLib.logging.error("main.js",`Js exception thrown: ${e.message}`)}catch(e1){console.error(`autobetLib.logging.error threw an exception: ${e1}`)}exception()}